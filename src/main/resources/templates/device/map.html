<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>학교 구조도</title>
    <style>
        .layout-container {
            display: flex;
            padding: 20px;
        }
        .canvas-container {
            flex: 1;
            position: relative;
        }
        .control-panel {
            width: 250px;
            padding: 20px;
            background: #f8f9fa;
            border-left: 1px solid #ddd;
        }
        canvas {
            border: 1px solid #ccc;
            background-color: #fff;
        }
        .room-list {
            margin-top: 20px;
        }
        .room-item {
            padding: 10px;
            margin: 5px 0;
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
        }
        .room-item:hover {
            background: #e9ecef;
        }
        .tool-panel {
            margin-bottom: 20px;
        }
        .btn {
            padding: 8px 12px;
            margin: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: white;
            cursor: pointer;
        }
        .btn:hover {
            background: #e9ecef;
        }
    </style>
</head>
<body>
    <div class="layout-container">
        <div class="canvas-container">
            <canvas id="layoutCanvas"></canvas>
        </div>
        <div class="control-panel">
            <div class="tool-panel">
                <button class="btn" onclick="layoutManager.resetView()">초기화</button>
                <button class="btn" onclick="layoutManager.saveLayout()">저장</button>
                <button class="btn" onclick="layoutManager.toggleGrid()">그리드</button>
            </div>
            <div class="room-list" id="roomList">
                <!-- 미배치 교실 목록 -->
            </div>
        </div>
    </div>

    <script>
        // 기본 설정
        const floorLayout = {
            floor3: {
                name: '3층',
                rooms: ['미술실', '음악실', '역기실', '정보실', '컴퓨터실', '예절실', '회장실', 
                       '3학년', '4학년', '교사연구실', '5학년', '6학년', '종합실']
            },
            floor2: {
                name: '2층',
                rooms: ['양치교실', '상담실', '영어실', '돌봄지원실', '돌봄교실', '회장실', 
                       '1학년', '2학년', '도움반', '전담실', '구강보건실', '도서관']
            },
            floor1: {
                name: '1층',
                rooms: ['현관', '소강당', '보건실', '숙직실', '방송실', '교무실', '현관', '회장실', 
                       '행정실', '교장실', '회의실', '현관', '유치원 다목적실', '유치원', '과학실', '현관']
            }
        };

        const specialAreas = {
            지친이실: { x: 50, y: 600 },
            식당: { x: 800, y: 600 },
            조리실: { x: 900, y: 600 },
            영양사실: { x: 900, y: 650 },
            강당: { x: 1100, y: 600 }
        };

        class SchoolLayoutManager {
            constructor() {
                this.canvas = document.getElementById('layoutCanvas');
                this.ctx = this.canvas.getContext('2d');
                this.cellWidth = 100;
                this.cellHeight = 80;
                this.floorGap = 150;
                this.showGrid = false;
                
                this.initCanvas();
                this.setupEventListeners();
            }

            initCanvas() {
                // Canvas 크기 설정
                this.canvas.width = 1400;
                this.canvas.height = 800;
                this.draw();
            }

            setupEventListeners() {
                this.canvas.addEventListener('mousedown', this.handleMouseDown.bind(this));
                this.canvas.addEventListener('mousemove', this.handleMouseMove.bind(this));
                this.canvas.addEventListener('mouseup', this.handleMouseUp.bind(this));
            }

            draw() {
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                
                if (this.showGrid) {
                    this.drawGrid();
                }

                // 각 층 그리기
                this.drawFloor(floorLayout.floor3, 50);
                this.drawFloor(floorLayout.floor2, 250);
                this.drawFloor(floorLayout.floor1, 450);
                
                // 특별 구역 그리기
                this.drawSpecialAreas();
            }

            drawGrid() {
                this.ctx.strokeStyle = '#eee';
                this.ctx.lineWidth = 0.5;

                // 수직선
                for (let x = 0; x <= this.canvas.width; x += this.cellWidth) {
                    this.ctx.beginPath();
                    this.ctx.moveTo(x, 0);
                    this.ctx.lineTo(x, this.canvas.height);
                    this.ctx.stroke();
                }

                // 수평선
                for (let y = 0; y <= this.canvas.height; y += this.cellHeight) {
                    this.ctx.beginPath();
                    this.ctx.moveTo(0, y);
                    this.ctx.lineTo(this.canvas.width, y);
                    this.ctx.stroke();
                }
            }

            drawFloor(floor, yOffset) {
                this.ctx.strokeStyle = '#333';
                this.ctx.fillStyle = '#333';
                this.ctx.lineWidth = 1;
                this.ctx.font = '12px Arial';

                floor.rooms.forEach((room, index) => {
                    const x = index * this.cellWidth;
                    this.drawRoom(room, x, yOffset);
                });
            }

            drawRoom(roomName, x, y) {
                this.ctx.strokeRect(x, y, this.cellWidth, this.cellHeight);
                
                // 텍스트 줄바꿈 처리
                const words = roomName.split(' ');
                let lineHeight = 15;
                words.forEach((word, index) => {
                    this.ctx.fillText(word, 
                        x + this.cellWidth/2 - this.ctx.measureText(word).width/2, 
                        y + 30 + (index * lineHeight));
                });
            }

            drawSpecialAreas() {
                Object.entries(specialAreas).forEach(([name, pos]) => {
                    this.drawRoom(name, pos.x, pos.y);
                });
            }

            toggleGrid() {
                this.showGrid = !this.showGrid;
                this.draw();
            }

            resetView() {
                this.draw();
            }

            saveLayout() {
                // 레이아웃 저장 로직 구현
                console.log('Layout saved');
            }
        }

        // 초기화
        const layoutManager = new SchoolLayoutManager();
    </script>
</body>
</html> 